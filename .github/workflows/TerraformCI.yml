name: TerraformCI
on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  id-token: write
  contents: read


jobs:
  call-terraform:
    uses: ./.github/workflows/TerraformChild.yml # 子ワークフローを呼び出す
    with:
      tf_dir: ${{ matrix.TF_DIR }} # 子ワークフローにディレクトリを渡す
    secrets:
      AWS_ACCOUNT_ID: ${{ secrets.AWS_ACCOUNT_ID }} # 親ワークフローからシークレットを渡す
    strategy:
      fail-fast: false
      matrix:
        TF_DIR:
          - AWS/Resources/RAG/vector_database/infra
          - AWS/Resources/RAG/fe/infra
          - AWS/Resources/RAG/embed_docs/infra
          - AWS/Resources/RAG/answer_user_query/infra

